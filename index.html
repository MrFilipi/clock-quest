<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ClockQuest ‚Äî Learn to read analog time</title>
<style>
  :root{
    --bg:#0b132b; --panel:#1c2541; --accent:#5bc0be; --accent2:#6fffe9; --good:#44d17c; --bad:#ff6b6b; --txt:#eef2f7;
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
  body{margin:0;background:var(--bg);color:var(--txt);display:flex;min-height:100svh;flex-direction:column}
  header,footer{padding:12px 16px;background:linear-gradient(90deg,var(--panel),#0f2045);}
  header{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between}
  .brand{font-weight:800;letter-spacing:.3px}
  main{display:grid;place-items:center;flex:1;padding:16px}
  .app{display:grid;gap:16px;max-width:980px;width:100%}
  .controls,.status{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .card{background:var(--panel);border-radius:12px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
  button,select,input[type=text]{border:1px solid #2f3b63;background:#0f2045;color:var(--txt);padding:10px 12px;border-radius:10px}
  button:hover{filter:brightness(1.1);cursor:pointer}
  button.primary{background:var(--accent);color:#042a2b;border-color:transparent;font-weight:700}
  button.good{background:var(--good);color:#06220f;border:0}
  button.bad{background:var(--bad);color:#2a0707;border:0}
  .pill{padding:6px 10px;border-radius:999px;background:#0f2045;border:1px solid #2f3b63}
  .clock-wrap{display:grid;grid-template-columns:1fr 360px;gap:16px}
  @media (max-width:960px){.clock-wrap{grid-template-columns:1fr}}
  canvas{width:100%;height:auto;background:#0f1a34;border-radius:50%;aspect-ratio:1/1;display:block}
  .qa{display:grid;gap:8px}
  .hint{font-size:.95rem;opacity:.9}
  .status .heart{color:#ff7676}
  .sr-only{position:absolute !important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);}
  .badge{background:#0f2045;border:1px solid #2f3b63;padding:6px 10px;border-radius:8px}
  .progress{height:10px;background:#0f2045;border-radius:8px;overflow:hidden}
  .progress>span{display:block;height:100%;background:var(--accent2);width:0%}
  a{color:var(--accent2)}

  /* ===== Answer Zone: highlight ===== */
  .answer-zone {
    border: 2px solid #2f3b63;
    border-radius: 14px;
    padding: 14px;
    position: relative;
    box-shadow: 0 8px 24px rgba(0,0,0,.25);
    animation: zonePulse 2.5s ease-in-out infinite;
  }
  .answer-zone.stop-pulse { animation: none; }
  @keyframes zonePulse {
    0%,100% { box-shadow: 0 0 0 rgba(111,255,233,0); }
    50% { box-shadow: 0 0 0 8px rgba(111,255,233,0.08); }
  }
  #prompt { font-size: 1.15rem; font-weight: 800; margin: 0 0 8px; }

  .mc-grid { display: grid; gap: 10px; grid-template-columns: 1fr; }
  @media (min-width: 560px){ .mc-grid { grid-template-columns: repeat(3,1fr); } }

  .choice {
    display:flex; align-items:center; gap:10px;
    border:2px solid #2f3b63; background:#0b1c3b;
    padding:14px 12px; border-radius:12px;
    font-size:1.05rem; font-weight:700; letter-spacing:.2px;
    min-height:56px; text-align:left;
  }
  .choice:hover,.choice:focus{outline:0;border-color:var(--accent2);filter:brightness(1.1)}
  .choice .badge-letter{
    width:32px;height:32px;border-radius:8px;display:grid;place-items:center;
    background:var(--accent);color:#042a2b;font-weight:900;
  }
  .choice.correct{border-color:var(--good);background:rgba(68,209,124,.12)}
  .choice.wrong{border-color:var(--bad);background:rgba(255,107,107,.12)}

  /* Typing mode field bigger */
  #typing input[type=text]{ font-size:1rem; width:100%; max-width:520px; }

  /* Small hint for keyboard */
  .kbd-hint{opacity:.8;font-size:.9rem;margin-top:6px}
  .kbd{border:1px solid #2f3b63;border-bottom-width:3px;border-radius:6px;padding:2px 6px}
</style>
</head>
<body>
<header>
  <div class="brand">üïí ClockQuest</div>
  <div class="controls" role="group" aria-label="Settings">
    <label class="pill">
      <span id="lblMode">Mode</span>
      <select id="mode">
        <option value="learn">Learn</option>
        <option value="practice" selected>Practice</option>
        <option value="challenge">Challenge</option>
      </select>
    </label>
    <label class="pill">
      <span id="lblLevel">Level</span>
      <select id="level">
        <option value="easy">Easy</option>
        <option value="medium" selected>Medium</option>
        <option value="hard">Hard</option>
      </select>
    </label>
    <button id="toggle-contrast" class="pill" aria-pressed="false">High contrast</button>
  </div>
</header>

<main>
  <section class="app card" aria-live="polite">
    <div class="clock-wrap">
      <!-- Clock -->
      <div class="card">
        <canvas id="clock" width="600" height="600" aria-label="Analog clock"></canvas>
        <div class="controls" style="margin-top:10px">
          <button id="btnNew" class="primary">Generate time</button>
          <button id="btnHint">Hint</button>
          <button id="btnShowNums">Show minute numbers</button>
          <button id="btnSetAsk">Ask to adjust hands</button>
        </div>
      </div>

      <!-- Right side: status + answers + report -->
      <div class="qa">
        <div class="status">
          <span class="badge"><span id="lblScore">Score</span>: <strong id="score">0</strong></span>
          <span class="badge"><span id="lblTime">Time</span>: <strong id="timer">‚Äî</strong></span>
          <span class="badge"><span id="lblLives">Lives</span>: <strong id="lives">3</strong> <span class="heart">‚ô•</span></span>
        </div>

        <!-- ANSWER ZONE -->
        <div class="card answer-zone" id="answerZone">
          <p id="prompt">Click ‚ÄúGenerate time‚Äù.</p>

          <div class="controls" style="margin-bottom:8px">
            <button id="btnMC" class="pill">Multiple choice</button>
            <button id="btnTyping" class="pill">Typing</button>
            <button id="btnDrag" class="pill">Drag hands</button>
          </div>

          <div id="mc" class="mc-grid" hidden></div>
          <div class="kbd-hint" id="kbdHint" hidden>
            Tip: press <span class="kbd">A</span>, <span class="kbd">B</span> or <span class="kbd">C</span>
          </div>

          <div id="typing" hidden>
            <div class="controls">
              <input id="answer" type="text" placeholder='e.g., "a quarter past three" or "3:15"' />
              <button id="btnCheck" class="good">Check</button>
              <button id="btnSkip" class="bad">Skip</button>
            </div>
          </div>

          <div id="dragInfo" class="hint" hidden></div>
          <div class="hint" id="hintArea"></div>

          <div style="margin-top:8px">
            <div class="progress" aria-label="Skill progress"><span id="pbar"></span></div>
          </div>
        </div>

        <div class="card">
          <h3>Report</h3>
          <div id="report"></div>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
  <small>¬© 2025 ClockQuest ‚Ä¢ <a href="#" id="how">How to publish on GitHub Pages</a></small>
</footer>

<script>
/* ===== Small helpers ===== */
const $ = s => document.querySelector(s);
const ctx = $("#clock").getContext("2d");

/* ===== Texts (EN only) ===== */
const TXT = {
  clickGenerate: 'Click ‚ÄúGenerate time‚Äù.',
  newTime: 'New time!',
  hintPast: 'Use ‚Äúpast‚Äù for 1‚Äì29 and ‚Äúhalf past‚Äù for :30.',
  hintTo: 'Use ‚Äúto‚Äù when minutes remain to next hour (31‚Äì59).',
  correct: 'Correct! +10',
  near: 'Almost! Check past/to and minutes.',
  wrong: 'Oops! Compare the hands.',
  reportTitle: 'Report',
  howGh: "Steps: 1) Create a repo and push this index.html. 2) Settings ‚Üí Pages ‚Üí Source: 'Deploy from a branch', branch main, /. 3) Open the published link.",
  showNumsOn: "Hide minute numbers",
  showNumsOff: "Show minute numbers",
  dragOn: "Drag the hands to your answer, then press Check.",
  askAdjust: "Now you must position the hands."
};

/* ===== Clock drawing (top=12 o'clock) ===== */
let showMinuteNums=false;
function drawClock(h=3,m=15){
  const c = $("#clock"); const w=c.width, hgt=c.height; const r = Math.min(w,hgt)/2-20;
  ctx.clearRect(0,0,w,hgt);
  ctx.save(); ctx.translate(w/2,hgt/2);

  // face
  ctx.beginPath(); ctx.arc(0,0,r+10,0,Math.PI*2); ctx.fillStyle="#102246"; ctx.fill();
  ctx.lineWidth=6; ctx.strokeStyle="#203a6c"; ctx.stroke();

  // minute ticks (0..59) with 12 at top
  for(let i=0;i<60;i++){
    const ang = i*Math.PI/30 - Math.PI/2; // rotate so 0 is top
    const len = (i%5===0)?14:6;
    ctx.beginPath();
    ctx.moveTo(Math.cos(ang)*(r-len), Math.sin(ang)*(r-len));
    ctx.lineTo(Math.cos(ang)*(r-2), Math.sin(ang)*(r-2));
    ctx.lineWidth=(i%5===0)?4:2;
    ctx.strokeStyle=(i%5===0)?"#5bc0be":"#2a3f74";
    ctx.stroke();

    if(showMinuteNums && i%5===0){
      ctx.fillStyle="#cfe9f3";
      ctx.font="14px system-ui";
      const label = (i===0?60:i); // show 60 at top
      ctx.fillText(String(label), Math.cos(ang)*(r-34)-6, Math.sin(ang)*(r-34)+5);
    }
  }

  // numbers 1..12 placed with top=12
  ctx.fillStyle="#e6f6ff"; ctx.font="22px system-ui";
  for(let n=1;n<=12;n++){
    const ang = (n*Math.PI/6) - Math.PI/2;
    ctx.fillText(String(n), Math.cos(ang)*(r-52)-8, Math.sin(ang)*(r-52)+8);
  }

  // hands (minute/hour) rotated with top=12
  const mh = (m/60)*Math.PI*2 - Math.PI/2;
  const hh = ((h%12)/12 + m/720)*Math.PI*2 - Math.PI/2;

  // hour hand
  ctx.strokeStyle="#6fffe9"; ctx.lineWidth=8; ctx.lineCap="round";
  ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(Math.cos(hh)*(r*0.5), Math.sin(hh)*(r*0.5)); ctx.stroke();
  // minute hand
  ctx.strokeStyle="#5bc0be"; ctx.lineWidth=6;
  ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(Math.cos(mh)*(r*0.75), Math.sin(mh)*(r*0.75)); ctx.stroke();

  // center
  ctx.fillStyle="#6fffe9"; ctx.beginPath(); ctx.arc(0,0,6,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

/* ===== Time utils ===== */
function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function pad2(n){return (n<10?'0':'')+n;}
const words = {
  1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine",10:"ten",11:"eleven",12:"twelve",
  13:"thirteen",14:"fourteen",15:"fifteen",16:"sixteen",17:"seventeen",18:"eighteen",19:"nineteen",
  20:"twenty",21:"twenty one",22:"twenty two",23:"twenty three",24:"twenty four",25:"twenty five",
  26:"twenty six",27:"twenty seven",28:"twenty eight",29:"twenty nine"
};
function toEnglish(h,m){
  const h12 = ((h%12)||12), next = ((h+1)%12)||12;
  if(m===0) return `${words[h12]} o‚Äôclock`;
  if(m===15) return `a quarter past ${words[h12]}`;
  if(m===30) return `half past ${words[h12]}`;
  if(m<30) return `${words[m]} past ${words[h12]}`;
  if(m===45) return `a quarter to ${words[next]}`;
  const remain = 60-m;
  return `${words[remain]} to ${words[next]}`;
}

/* ===== Game Engine ===== */
let target={h:3,m:15}, mode="practice", level="medium";
let score=0,lives=3,timer=null,seconds=0,attempt=0;
let dragMode=false, dragHand=null;
let currentShown={h:3,m:15};

function levelMinutes(){
  if(level==="easy") return [0,5,10,15,20,25,30,35,40,45,50,55].filter(x=>x<=40?true:[0,5,10,15,20,25,30].includes(x));
  if(level==="medium") return [0,5,10,15,20,25,30,35,40,45,50,55];
  return Array.from({length:60},(_,i)=>i);
}

function generateTime(){
  const mins = levelMinutes(); const m = mins[randInt(0,mins.length-1)];
  const h = randInt(1,12);
  target={h,m};
  drawClock(h,m);
  attempt=0;
  $("#prompt").textContent = TXT.newTime;
  $("#hintArea").textContent = "";
  buildMC();
}

function englishAcceptList(h,m){
  const list = [];
  list.push(toEnglish(h,m));
  list.push(`${((h%12)||12)}:${pad2(m)}`); // numeric 12-hour
  if(m===0) list.push(`${((h%12)||12)} oclock`, `${((h%12)||12)} o‚Äôclock`);
  return list.map(s=>s.toLowerCase());
}

function checkTextAnswer(){
  const val = $("#answer").value.trim().toLowerCase();
  const en = englishAcceptList(target.h,target.m);
  attempt++;
  const correctEN = en.includes(val);
  if(correctEN){
    onCorrect();
  } else if(similar(val, en)){
    flash(TXT.near);
  } else {
    onWrong();
  }
}
function similar(val, list){
  return list.some(x=>lev(val,x)<=2);
}
function lev(a,b){
  const m=[]; for(let i=0;i<=b.length;i++){m[i]=[i]} for(let j=0;j<=a.length;j++){m[0][j]=j}
  for(let i=1;i<=b.length;i++){for(let j=1;j<=a.length;j++){
    m[i][j]=Math.min(m[i-1][j]+1,m[i][j-1]+1,m[i-1][j-1]+(b[i-1]==a[j-1]?0:1));
  }}
  return m[b.length][a.length];
}

function onCorrect(){
  score+=10+(attempt===1?5:0);
  $("#score").textContent=score;
  flash(TXT.correct);
  progress(10);
  $("#answerZone").classList.add("stop-pulse");
  if(mode==="challenge") generateTime();
}
function onWrong(){
  if(++attempt>=3){ giveHint(); }
  lives--; $("#lives").textContent=lives;
  flash(TXT.wrong);
  if(mode==="challenge" && lives<=0) endChallenge();
}

function buildMC(){
  const correct = toEnglish(target.h,target.m);
  const set = new Set([correct]);
  while(set.size<3){
    let h = randInt(1,12);
    let m = (level==="hard") ? randInt(0,59) : [0,5,10,15,20,25,30,35,40,45,50,55][randInt(0,11)];
    set.add(toEnglish(h,m));
  }
  const opts = Array.from(set).sort(()=>Math.random()-0.5);
  const letters = ["A","B","C"];
  const mc = $("#mc"); mc.innerHTML=""; mc.hidden=false;
  $("#typing").hidden = true;
  $("#kbdHint").hidden = false;
  $("#answerZone").classList.remove("stop-pulse");

  opts.forEach((text, idx)=>{
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.setAttribute("data-letter", letters[idx]);
    btn.setAttribute("data-correct", text===correct ? "1" : "0");
    btn.innerHTML = `<span class="badge-letter">${letters[idx]}</span><span>${text}</span>`;
    btn.addEventListener("click", ()=> chooseMC(btn));
    mc.appendChild(btn);
  });

  // keyboard shortcuts
  window.onkeydown = (e)=>{
    const k = e.key.toUpperCase();
    const pos = letters.indexOf(k);
    if(pos>-1){
      const btn = mc.children[pos];
      if(btn) chooseMC(btn);
    }
  };
}

function chooseMC(btn){
  $("#answerZone").classList.add("stop-pulse");
  [...document.querySelectorAll(".choice")].forEach(b=>b.classList.remove("correct","wrong"));
  const correct = btn.getAttribute("data-correct")==="1";
  if(correct){ btn.classList.add("correct"); onCorrect(); }
  else{ btn.classList.add("wrong"); onWrong(); }
}

function giveHint(){
  const m=target.m;
  $("#hintArea").textContent = (m<=30)? TXT.hintPast : TXT.hintTo;
}

function startChallenge(){
  score=0; lives=3; seconds=90;
  $("#score").textContent=score; $("#lives").textContent=lives; $("#timer").textContent=seconds;
  timer = setInterval(()=>{ seconds--; $("#timer").textContent=seconds; if(seconds<=0) endChallenge(); },1000);
  generateTime();
}
function endChallenge(){
  clearInterval(timer); timer=null;
  flash(`${TXT.reportTitle}: ${score} pts`);
  saveHighscore(score);
  $("#report").innerHTML = renderHighscores();
}

function progress(p){ const el=$("#pbar"); const cur=parseInt(el.style.width||"0"); el.style.width = Math.min(100,cur+p)+"%"; }
function flash(msg){ $("#prompt").textContent=msg; }

function saveHighscore(s){
  const key="cq_scores";
  const arr = JSON.parse(localStorage.getItem(key)||"[]");
  const name = localStorage.getItem("cq_name")||"Player";
  arr.push({name,score:s,ts:Date.now()});
  arr.sort((a,b)=>b.score-a.score);
  localStorage.setItem(key, JSON.stringify(arr.slice(0,5)));
}
function renderHighscores(){
  const key="cq_scores";
  const arr = JSON.parse(localStorage.getItem(key)||"[]");
  if(!arr.length) return "<em>No highscores yet.</em>";
  return "<ol>"+arr.map(x=>`<li>${x.name}: <strong>${x.score}</strong></li>`).join("")+"</ol>";
}

/* ===== Drag mode (simple minute-hand drag) ===== */
$("#clock").addEventListener("mousedown", e=>{ if(!dragMode) return;
  const rect = e.target.getBoundingClientRect();
  const x = e.clientX-rect.left-rect.width/2;
  const y = e.clientY-rect.top-rect.height/2;
  const a = Math.atan2(y,x);
  dragHand = "minute"; setMinuteFromAngle(a);
});
$("#clock").addEventListener("mousemove", e=>{
  if(!dragMode || !dragHand) return;
  const rect = e.target.getBoundingClientRect();
  const x = e.clientX-rect.left-rect.width/2;
  const y = e.clientY-rect.top-rect.height/2;
  const a = Math.atan2(y,x);
  setMinuteFromAngle(a);
});
window.addEventListener("mouseup", ()=> dragHand=null);

function setMinuteFromAngle(a){
  // convert angle to minutes, considering top=12
  let deg = a*180/Math.PI; deg=(deg+90+360)%360; // 0 at top
  const m = Math.round(deg/6)%60;
  currentShown.m=m;
  drawClock(currentShown.h,currentShown.m);
}
function setHourFromTarget(){ currentShown.h=target.h; drawClock(currentShown.h,currentShown.m); }

/* ===== UI Wiring ===== */
$("#btnNew").addEventListener("click", generateTime);
$("#btnHint").addEventListener("click", giveHint);
$("#btnShowNums").addEventListener("click", ()=>{
  showMinuteNums=!showMinuteNums;
  $("#btnShowNums").textContent = showMinuteNums ? TXT.showNumsOn : TXT.showNumsOff;
  drawClock(target.h,target.m);
});
$("#btnSetAsk").addEventListener("click", ()=>{
  dragMode=true; $("#dragInfo").hidden=false; $("#dragInfo").textContent=TXT.askAdjust; setHourFromTarget();
});
$("#btnMC").addEventListener("click", ()=>{ $("#mc").hidden=false; $("#typing").hidden=true; $("#kbdHint").hidden=false; });
$("#btnTyping").addEventListener("click", ()=>{ $("#mc").hidden=true; $("#typing").hidden=false; $("#kbdHint").hidden=true; $("#answer").focus(); $("#answerZone").classList.remove("stop-pulse"); });
$("#btnDrag").addEventListener("click", ()=>{ dragMode=true; $("#dragInfo").hidden=false; $("#dragInfo").textContent=TXT.dragOn; });

$("#btnCheck").addEventListener("click", checkTextAnswer);
$("#btnSkip").addEventListener("click", generateTime);
$("#answer").addEventListener("focus", ()=> $("#answerZone").classList.add("stop-pulse"));

$("#mode").addEventListener("change", e=>{
  mode=e.target.value;
  if(mode==="challenge") startChallenge(); else { if(timer){clearInterval(timer); timer=null;} $("#timer").textContent="‚Äî"; }
});
$("#level").addEventListener("change", e=>{ level=e.target.value; });

$("#how").addEventListener("click", (e)=>{ e.preventDefault(); alert(TXT.howGh); });

$("#toggle-contrast").addEventListener("click", (e)=>{
  const pressed = e.target.getAttribute("aria-pressed")==="true";
  e.target.setAttribute("aria-pressed", String(!pressed));
  document.documentElement.style.setProperty('--panel', pressed?'#1c2541':'#0a0f24');
  document.documentElement.style.setProperty('--bg', pressed?'#0b132b':'#00040d');
});

/* Init */
drawClock(target.h,target.m);
$("#prompt").textContent=TXT.clickGenerate;
$("#report").innerHTML = renderHighscores();
</script>
</body>
</html>
feat: EN-only UI + highlighted Answer Zone
